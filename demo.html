<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Demo</title>

  <style>
    :root{
      --demo-bg: rgba(10,10,20,0.55);
      --demo-card: rgba(255,255,255,0.92);
      --demo-border: rgba(140,120,160,0.30);
      --demo-accent: #7E57C2;
      --demo-text: #111;
    }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#fff;
    }

    /* The real app */
    #appFrame{
      width: 100vw;
      height: 100vh;
      border: 0;
      display:block;
    }

    /* Overlay */
    #demoOverlay{
      position: fixed;
      inset: 0;
      background: var(--demo-bg);
      display:none;
      z-index: 999999;
        pointer-events: none; /* ✅ ADD THIS */

    }

    /* Highlight rectangle */
    #demoHighlight{
      position: fixed;
      border: 3px solid var(--demo-accent);
      border-radius: 14px;
      box-shadow: 0 0 0 6px rgba(126,87,194,0.18), 0 18px 50px rgba(0,0,0,0.35);
      pointer-events: none;
      display:none;
      z-index: 1000000;
    }

    /* Tooltip card */
    #demoCard{
      position: fixed;
      width: min(420px, calc(100vw - 28px));
      background: var(--demo-card);
      border: 1px solid var(--demo-border);
      border-radius: 16px;
      padding: 14px;
      color: var(--demo-text);
      box-shadow: 0 18px 60px rgba(0,0,0,0.35);
      z-index: 1000001;
      display:none;
    }

    #demoTitle{
      font-weight: 800;
      font-size: 16px;
      margin: 0 0 6px 0;
    }

    #demoText{
      margin: 0 0 10px 0;
      line-height: 1.35;
      font-size: 14px;
    }

    #demoVideo{
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: 12px;
      background: #000;
      display:none;
      margin: 8px 0 10px 0;
      overflow:hidden;
    }

    #demoVideo video{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    #demoControls{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content: space-between;
      margin-top: 8px;
    }

    .btn{
      border: 0;
      background: var(--demo-accent);
      color: #fff;
      border-radius: 10px;
      padding: 10px 12px;
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
    }

    .btn.secondary{
      background: #111;
    }

    .btn.ghost{
      background: transparent;
      color: #111;
      border: 1px solid rgba(0,0,0,0.18);
    }

    #demoStep{
      font-size: 13px;
      opacity: 0.8;
      font-weight: 600;
    }

    /* Small top bar for starting the tour */
    #demoTopBar{
      position: fixed;
      top: 14px;
      right: 14px;
      z-index: 1000002;
      display:flex;
      gap:10px;
      align-items:center;
    }
  </style>
</head>

<body>
  <!-- Your real app loads here -->
  <iframe id="appFrame" title="App"></iframe>

  <!-- Quick start button always visible -->
  <div id="demoTopBar">
    <button class="btn" id="startTourBtn">Start Demo</button>
    <button class="btn ghost" id="stopTourBtn" style="display:none;">Exit</button>
  </div>

  <!-- Overlay + highlight + card -->
  <div id="demoOverlay"></div>
  <div id="demoHighlight"></div>

  <div id="demoCard">
    <h3 id="demoTitle"></h3>
    <p id="demoText"></p>

    <div id="demoVideo">
      <video id="demoVideoEl" controls playsinline></video>
    </div>

    <div id="demoControls">
      <button class="btn ghost" id="backBtn">Back</button>
      <div id="demoStep"></div>
      <div style="display:flex; gap:10px;">
        <button class="btn secondary" id="skipBtn">Skip</button>
        <button class="btn" id="nextBtn">Next</button>
      </div>
    </div>
  </div>

<script>
  // ✅ STEP 1: SET YOUR REAL APP PAGE HERE
  const APP_URL = "https://riashandilya-svg.github.io/classicbollywoodmelodies/demo-app.html";

  // ✅ STEP 2: Define demo steps using CSS selectors that exist on the app page.
  // If a selector isn’t found, the step will still show, but without highlight.
  const STEPS = [
    {
      title: "Welcome",
      text: "This is a guided demo. I’ll highlight the exact feature blocks on the real page.",
      selector: null,
      video: null
    },
    {
      title: "Start Practice",
      text: "This button starts the practice flow.",
      selector: "#startPracticeButton",
      video: null
        waitForClick: true

    },
    {
      title: "Play Full Song",
      text: "This plays the full song playback with visuals.",
      selector: "#playSongButton",
      video: null
    },
    {
      title: "Free Mode",
      text: "Free Mode lets you play any notes and get feedback.",
      selector: "#freeModeButton",
      video: null
    },
    {
      title: "Speed Controls",
      text: "Use these to slow down or speed up training.",
      selector: "#speedDisplay",
      video: null
    }
  ];

  const frame = document.getElementById("appFrame");
  const overlay = document.getElementById("demoOverlay");
  const hi = document.getElementById("demoHighlight");
  const card = document.getElementById("demoCard");
  const titleEl = document.getElementById("demoTitle");
  const textEl = document.getElementById("demoText");
  const stepEl = document.getElementById("demoStep");

  const videoWrap = document.getElementById("demoVideo");
  const videoEl = document.getElementById("demoVideoEl");

  const startBtn = document.getElementById("startTourBtn");
  const stopBtn = document.getElementById("stopTourBtn");
  const nextBtn = document.getElementById("nextBtn");
  const backBtn = document.getElementById("backBtn");
  const skipBtn = document.getElementById("skipBtn");

let idx = 0;
let running = false;

// ✅ for "wait until user clicks"
let waitCleanup = null;
let waitSatisfied = false;


  frame.src = APP_URL;

  function showTour(){
    running = true;
    overlay.style.display = "block";
    card.style.display = "block";
    stopBtn.style.display = "inline-block";
    startBtn.style.display = "none";
    goTo(0);
  }

  function hideTour(){
    running = false;
    overlay.style.display = "none";
    hi.style.display = "none";
    card.style.display = "none";
    stopBtn.style.display = "none";
    startBtn.style.display = "inline-block";
    stopVideo();
    if (waitCleanup) {
  waitCleanup();
  waitCleanup = null;
}
waitSatisfied = false;
setNextEnabled(true);

  }

  function stopVideo(){
    videoEl.pause();
    videoEl.removeAttribute("src");
    videoEl.load();
    videoWrap.style.display = "none";
  }

  function playVideo(src){
    if (!src){
      stopVideo();
      return;
    }
    videoEl.src = src;
    videoWrap.style.display = "block";
    videoEl.currentTime = 0;
    videoEl.play().catch(()=>{});
  }

  function placeCardNear(rect){
    let top = 24;
    let left = 24;

    if (rect){
      const spaceBelow = window.innerHeight - rect.bottom;
      const preferBelow = spaceBelow > 240;

      top = preferBelow ? (rect.bottom + 14) : Math.max(14, rect.top - 14 - card.offsetHeight);
      left = Math.min(Math.max(14, rect.left), window.innerWidth - card.offsetWidth - 14);
    } else {
      top = 28;
      left = window.innerWidth - card.offsetWidth - 28;
    }

    card.style.top = top + "px";
    card.style.left = left + "px";
  }

  function highlight(selector){
    const doc = frame.contentWindow?.document;
    if (!doc || !selector) return null;

    const el = doc.querySelector(selector);
    if (!el) return null;

    const r = el.getBoundingClientRect();
    const frameRect = frame.getBoundingClientRect();

    const rect = {
      left: frameRect.left + r.left,
      top: frameRect.top + r.top,
      right: frameRect.left + r.right,
      bottom: frameRect.top + r.bottom,
      width: r.width,
      height: r.height
    };

    const pad = 8;
    hi.style.display = "block";
    hi.style.left = (rect.left - pad) + "px";
    hi.style.top = (rect.top - pad) + "px";
    hi.style.width = (rect.width + pad*2) + "px";
    hi.style.height = (rect.height + pad*2) + "px";

    return rect;
  }
function setNextEnabled(enabled){
  nextBtn.disabled = !enabled;
  nextBtn.style.opacity = enabled ? "1" : "0.55";
  nextBtn.style.cursor = enabled ? "pointer" : "not-allowed";
}

function setupWaitForClick(selector){
  // clean up any previous waiting listener
  if (waitCleanup) {
    waitCleanup();
    waitCleanup = null;
  }
  waitSatisfied = false;

  // If no selector, nothing to wait for
  if (!selector) {
    setNextEnabled(true);
    return;
  }

  const doc = frame.contentWindow?.document;
  if (!doc) {
    setNextEnabled(true);
    return;
  }

  const el = doc.querySelector(selector);
  if (!el) {
    // If element not found, don't block the demo
    setNextEnabled(true);
    return;
  }

  // Disable Next until they click the target
  setNextEnabled(false);

  const onClick = (e) => {
    waitSatisfied = true;
    setNextEnabled(true);

    // remove listener after first click
    el.removeEventListener("click", onClick, true);
    waitCleanup = null;
  };

  // Use capture so we catch it even if the app stops propagation
  el.addEventListener("click", onClick, true);

  // cleanup function for when user goes back/next/exit
  waitCleanup = () => {
    el.removeEventListener("click", onClick, true);
  };
}

  function render(){
    const step = STEPS[idx];

    titleEl.textContent = step.title;
    textEl.textContent = step.text;
    stepEl.textContent = `${idx + 1} / ${STEPS.length}`;

    backBtn.disabled = idx === 0;
    nextBtn.textContent = (idx === STEPS.length - 1) ? "Done" : "Next";

    stopVideo();
    const rect = highlight(step.selector);
    placeCardNear(rect);
    playVideo(step.video);
    // ✅ if this step requires clicking the feature, wait for it
if (step.waitForClick) {
  setupWaitForClick(step.selector);
} else {
  // normal steps: Next is available
  if (waitCleanup) {
    waitCleanup();
    waitCleanup = null;
  }
  waitSatisfied = false;
  setNextEnabled(true);
}

  }

  function goTo(newIndex){
    idx = Math.max(0, Math.min(STEPS.length - 1, newIndex));
    render();
  }

  startBtn.addEventListener("click", showTour);
  stopBtn.addEventListener("click", hideTour);


  nextBtn.addEventListener("click", () => {
    if (idx === STEPS.length - 1) hideTour();
    else goTo(idx + 1);
  });

  backBtn.addEventListener("click", () => goTo(idx - 1));
  skipBtn.addEventListener("click", hideTour);

  window.addEventListener("resize", () => {
    if (running) render();
  });
  window.addEventListener("load", () => {
  showTour();
});

</script>

</body>
</html>
